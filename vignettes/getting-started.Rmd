---
title: "getting-started"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{getting-started}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

First let's load the necessary packages: 

```{r setup}
library(dplyr)
library(STexampleData)
library(igraph)
library(tidyverse)
library(MorphoGAM)
library(ggpubr)
```

Now, let 's load the Slide-seqV2 mouse hippocampus data from the STexampleData package:

```{r}

spe <- STexampleData::SlideSeqV2_mouseHPC()

ixs <- which(spe$celltype == "CA3") #subset to CA3

xy <- spatialCoords(spe)[ixs,]
Y <- counts(spe)[,ixs]

plot(xy)
```


To remove outliers, we calculate the distance matrix and remove points that are further away than a certain threshold:

```{r}
xy.dist <- as.matrix(dist(xy))
knn <- 20
prune.outlier <- 3
nnk <- apply(xy.dist, 1, function(x) sort(x)[knn+1])
outlier <- which(nnk > (prune.outlier)*median(nnk))

xy <- xy[-outlier,]; Y <- Y[,-outlier]
```


Next, we fit a curve to the spatial coordinates using the `CurveFinder` function:

```{r}
fit <- CurveFinder(xy)
```

```{r}
ggarrange(fit$curve.plot, fit$coordinate.plot, nrow=1)
```

Now, we can fit a GAM model using the `MorphoGAM` function:
